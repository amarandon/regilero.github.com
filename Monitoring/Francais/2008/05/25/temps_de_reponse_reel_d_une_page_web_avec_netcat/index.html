<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title> Temps de réponse réél d'une page web avec ... netcat |  RBleug</title>
    <meta name="description" content="Regilero's blog; Mostly tech things about web stuff."/>
    <meta name="author" content="regilero"/>
    <link rel="icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script src="/theme/js/effects.js" ></script>
    <!-- <script src="/theme/js/jquery.jparallax.js"></script> -->
    <link rel="stylesheet" href="/theme/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/blueprint/print.css" type="text/css" media="print">
    <link rel="stylesheet" href="/theme/syntax.css" type="text/css" />
    <!--[if lt IE 8]>
      <link rel="stylesheet" href="/theme/blueprint/ie.css" type="text/css" media="screen, projection">
    <![endif]-->
    <link rel="stylesheet" href="/theme/blueprint/plugins/link-icons/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/fontello/css/fontello.css">
    <!--[if IE 7]><link rel="stylesheet" href="/theme/fontello/css/fontello-ie7.css"><![endif]-->
    <link href="/theme/style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="container">
       <div id="branding" class="column span-24 last">
         <h1 class="logo"><a href="/">RBleug</a></h1>
         <hr/>
         <h2 class="alt">Regilero's blog; Mostly tech things about web stuff.</h2>
       </div>
       
       <div id="menu" class="column span-24 last">
         <ul class="topNav">
            <li><a href="/" class="topNavAct" ><i class="icon-home"></i>Tech notes</a></li>
            <li><a href="/archive/"   ><i class="icon-th"></i>Archives</a></li>
            <li><a href="/contact/"  ><i class="icon-phone"></i>Contact</a></li>
            <li><a href="/feed.xml"><i class="icon-rss"></i>RSS Feed</a></li>
         </ul>
         <div class="clear"></div>
       </div>
       
       <div id="content" class="">
           <div id="left-content" class="column span-15 prepend-1">
             
            <article>
        <header>
            <h2>Temps de réponse réél d'une page web avec ... netcat
            <span><i class="icon-clock"></i><time datetime="2008-05-25">May 25, 2008</time></span><br/>
            <span class="category"><i class="icon-list"></i> <a href="/Francais/">Francais</a> and <a href="/Monitoring/">Monitoring</a></span>
            </h2>
        </header>

        <div class="entry">
          <img class="left" src="/theme/img/pic/whiteflower2.png" width="260" alt="Comment obtenir le temps de réponse d'un site avec une ligne de commande concise, sans wget et sans telnet (mais avec netcat)" title="Comment obtenir le temps de réponse d'un site avec une ligne de commande concise, sans wget et sans telnet (mais avec netcat)" />
          <p>Bon, j'imagine que la plupart des gens (heu.. d'un certain type) savent qu'on peut faire du web <strong>à la main</strong> avec telnet ou netcat.
Et bien on peut. Donc.
Je voulais me servir de cela pour tracer quelques temps de réponse de pages html précises.
Le tout en une seule ligne histoire de se servir de l'historique et pas de mon cerveau pour la retaper.</p>

<p>Commencons par un telnet sur <a href="http://www.google.com">www.google.com</a> sur le port 80 (web).
On tape la requète comme si nous étions un navigateur web (très basique le navigateur). La requète HTTP va donc être:</p>

<div class="highlight"><pre><code class="http"><span class="err">  </span><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span>
 <span class="l"> </span>
</code></pre></div>


<p>Remarquez qu'il y a une ligne vide (donc deux fois entrée).</p>

<p>Cela donne en résultat une page de redirection vers le site français de google, parfait.</p>

<div class="highlight"><pre><code class="bash">  nii:~<span class="nv">$ </span>telnet www.google.com 80
  Trying 209.85.129.147...
  Connected to www.l.google.com.
  Escape character is <span class="s1">&#39;^]&#39;</span>.
  GET / HTTP/1.0
  .
  HTTP/1.0 302 Found
  Location: http://www.google.fr/
  <span class="o">(</span>.. je vous passe le reste ...<span class="o">)</span>
  Connection closed by foreign host.
  nii:~<span class="err">$</span>
</code></pre></div>


<p>Bon, maintenant je veux mesurer le temps de réponse. Avec tout bètement la commande 'time'.
Pour faire cela l'idéal est de taper ma commande en une seule fois,
et là telnet n'est plus très souple pour automatiser la saisie utilisateur On va commencer par tester la même chose avec netcat (nc)</p>

<div class="highlight"><pre><code class="http"><span class="err">  nii:~$ printf &#39;GET / HTTP/1.0\n\n&#39; | \</span>
<span class="err">  nc -w 10 www.exemple.com 80</span>
</code></pre></div>


<p>On avance. Par contre on a de fortes chances de ne pas tomber sur la page web que l'on recherche vraiment.
On a de très fortes chances de tomber sur le VirtualHost par défaut du serveur HTTP
à l'autre bout.
Mais pour servir le bon site il faut taper du <strong><em>HTTP/1.1</em></strong> au lieu de 1.0 et ajouter un header à notre
requète indiquant au serveur le nom du site que l'on veut (parmi ceux qu'il héberge),
revoyez le protocole <a href="http://en.wikipedia.org/wiki/HTTP#Request_Message">http version 1.1</a> si vous ne comprenez rien à ce que je dis.</p>

<div class="highlight"><pre><code class="http"><span class="err">  nii:~$ printf &#39;GET / HTTP/1.1\nHost:www.exemple.com\n\n&#39; | \</span>
<span class="err">  nc -w 10 -q 10 www.exemple.com 80</span>
</code></pre></div>


<p>Et maintenant pour avoir le temps de la commande je rajoute time au début et je fais sauter le temps d'affichage de la réponse...</p>

<div class="highlight"><pre><code class="http"><span class="err">  nii:~$ time printf &#39;GET / HTTP/1.1\nHost:www.exemple.com\n\n&#39; | \</span>
<span class="err">  nc -w 10 -q 10 www.exemple.com 80 1&gt;/dev/null</span>
<span class="err">  .</span>
<span class="err">  real    0m0.627s</span>
<span class="err">  user    0m0.000s</span>
<span class="err">  sys     0m0.004s</span>
<span class="err">  nc -w 10 -q 10 www.exemple.com 80</span>
</code></pre></div>


<p><strong><em>Mais...</em></strong><br/>
Il y a une grosse erreur.
On se prends <strong><em>le temps d'une requète DNS</em></strong> de la machine sur laquelle on est qui cherche l'adresse IP de l'hôte
que l'on a donné à netcat (après le nc -w 10) pour aller ouvrir une connexion tcp sur le port 80 de cet hôte.
Ce temps DNS ne sert à rien, il fausse notre résultat (et c'est souvent très long le DNS).
Il faut utiliser l'adresse IP du serveur web directement.
De toutes façons c'est à l'intérieur du protocole HTTP, avec notre entête <strong>Host:</strong> que l'on indique le site web
demandé au serveur, et pas du tout avec le nom DNS utilisé pour résoudre l'adresse IP du serveur web.</p>

<div class="highlight"><pre><code class="http"><span class="err">  nii:~$ nslookup ww.exemple.com</span>
<span class="err">  66.116.125.121</span>
<span class="err">  nii:~$ time printf &#39;GET / HTTP/1.1\nHost:www.exemple.com\n\n&#39; | \</span>
<span class="err">  nc -w 10 -q 10 66.116.125.121 80 1&gt;/dev/null</span>
<span class="err">  .</span>
<span class="err">  real    0m0.408s</span>
<span class="err">  user    0m0.004s</span>
<span class="err">  sys     0m0.000s</span>
</code></pre></div>


<p><strong><em>0.408s</em></strong> est déjà plus proche du temps de réponse réèl du site (depuis le point du réseau où on se trouve,
 il y a des pertes dues au réseau, forcément).</p>

<p>PS: vive les sites <a href="http://www.dgate.org/~brg/bvtelnet80/">Best Viewed with telnet to port 80</a></p>

        </div>
        <div class="tag"><i class="icon-tag"></i><a href="/tag/Apache/">Apache</a>, <i class="icon-tag"></i><a href="/tag/HTTP/">HTTP</a>, <i class="icon-tag"></i><a href="/tag/Linux/">Linux</a>, <i class="icon-tag"></i><a href="/tag/Monitoring/">Monitoring</a>, <i class="icon-tag"></i><a href="/tag/Nginx/">Nginx</a></div>
</article>

    
    
           </div>
           <div id="sideBar" class="column span-8 last">
            
            <div class="sideBarListBox">
              <h3>Related posts</h3>
              <ul>
                
                   <li><a href="/Apache/English/2009/11/06/more_on_static_file_redirector/">More on Static file redirector</a></li>
                
                   <li><a href="/Apache/English/2009/11/05/use_rewrite_map_to_prevent_proxying_for_some_static_contents/">Use RewriteMap to prevent proxying for some static contents</a></li>
                
              </ul>
            </div>
            
    
        <div class="sideBarListBox">
          <h3>Latest posts</h3>
          <ul>
              
                 <li><a href="/Drupal/English/2011/10/18/drupal_mongodb_statistics_module_published/">Drupal - Mongodb statistics module published</a></li>
              
                 <li><a href="/Drupal/English/2011/10/03/separate_cache_backends_d6_and_d7/">Separate cache Backends with Drupal6 and Drupal7.</a></li>
              
                 <li><a href="/Apache/English/2009/11/06/more_on_static_file_redirector/">More on Static file redirector</a></li>
              
                 <li><a href="/Apache/English/2009/11/05/use_rewrite_map_to_prevent_proxying_for_some_static_contents/">Use RewriteMap to prevent proxying for some static contents</a></li>
              
                 <li><a href="/Monitoring/Francais/2008/05/25/temps_de_reponse_reel_d_une_page_web_avec_netcat/">Temps de réponse réél d'une page web avec ... netcat</a></li>
              
          </ul>
        </div>
        
        <div class="sideBarMore">
          <h3>More</h3>
            <a href="http://stackoverflow.com/users/550618/regilero">
            <img src="http://stackoverflow.com/users/flair/550618.png" width="208" height="58" alt="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
            </a>
            <a href="http://stackexchange.com/users/264377/regilero"><img src="http://stackexchange.com/users/flair/264377.png?theme=clean" width="208" height="58" alt="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" /></a>
        </div>
        
        <div class="sideBarListBox">
          <h3>Tags</h3>
          <a style='font-size: 70%' href='/tag/Nginx/'>Nginx</a>
<a style='font-size: 120%' href='/tag/Drupal/'>Drupal</a>
<a style='font-size: 149%' href='/tag/HTTP/'>HTTP</a>
<a style='font-size: 70%' href='/tag/Monitoring/'>Monitoring</a>
<a style='font-size: 70%' href='/tag/Cache/'>Cache</a>
<a style='font-size: 70%' href='/tag/Linux/'>Linux</a>
<a style='font-size: 120%' href='/tag/RewriteMap/'>RewriteMap</a>
<a style='font-size: 120%' href='/tag/Proxy/'>Proxy</a>
<a style='font-size: 170%' href='/tag/Performance/'>Performance</a>
<a style='font-size: 120%' href='/tag/Plone/'>Plone</a>
<a style='font-size: 70%' href='/tag/Apache/'>Apache</a>
<a style='font-size: 120%' href='/tag/mod_rewrite/'>mod_rewrite</a>
<a style='font-size: 70%' href='/tag/Mongodb/'>Mongodb</a>
<a style='font-size: 70%' href='/tag/Statistics/'>Statistics</a>

        </div>
        
        <div class="sideBarItem">
          <h3>Friends</h3>
            <ul>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.org">Blogs Makina Corpus<div class="cover-right"><img src="/theme/img/makinaorg.png" height="30" width="30"><img src="/theme/img/makinaorg_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.com">Makina Corpus<div class="cover-right"><img src="/theme/img/makinacom.png" height="30" width="30"><img src="/theme/img/makinacom_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.processus.org/">Pounard, processus.org<div class="cover-right"><img src="/theme/img/pounard.png" height="30" width="30"><img src="/theme/img/pounard_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://toutpt.makina-corpus.org/" >Toupt<div class="cover-right"><img src="/theme/img/toupt.png" height="30" width="30"><img src="/theme/img/toupt_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://francoisgaudin.com/">François Gaudin<div class="cover-right"><img src="/theme/img/gaudin.png" height="30" width="30"><img src="/theme/img/gaudin_banner.png" height="30" width="117"></div></a></li>
            </ul>
            <div class="clear"></div>
        </div>
        
      </div> <!-- end sidebar -->
        
         </div><!-- end content -->
         
         <div id="footer" class="column span-24 last">
            <hr />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">regilero's blog</span> est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/">licence Creative Commons Attribution -  Partage dans les Mêmes Conditions 3.0 France</a>.<br />Fondé(e) sur une œuvre à <a xmlns:dct="http://purl.org/dc/terms/" href="http://regilero.github.io" rel="dct:source">http://regilero.github.io</a>.
         </div>

      </div><!-- end container -->
    </body>
</html>
