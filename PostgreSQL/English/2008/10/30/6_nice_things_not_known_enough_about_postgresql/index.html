<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title> 6 nice things not know enough about PostgreSQL |  RBleug</title>
    <meta name="description" content="Regilero's blog; Mostly tech things about web stuff."/>
    <meta name="author" content="regilero"/>
    <link rel="author" href="/contact/" title="who am I?" type="text/html" />
    <link rel="icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script src="/theme/js/effects.js" ></script>
    <!-- <script src="/theme/js/jquery.jparallax.js"></script> -->
    <link rel="stylesheet" href="/theme/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/blueprint/print.css" type="text/css" media="print">
    <link rel="stylesheet" href="/theme/syntax.css" type="text/css" />
    <!--[if lt IE 8]>
      <link rel="stylesheet" href="/theme/blueprint/ie.css" type="text/css" media="screen, projection">
    <![endif]-->
    <link rel="stylesheet" href="/theme/blueprint/plugins/link-icons/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/fontello/css/fontello.css">
    <!--[if IE 7]><link rel="stylesheet" href="/theme/fontello/css/fontello-ie7.css"><![endif]-->
    <link href="/theme/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40859893-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
  </head>
  <body>
    <div class="container">
       <div id="branding" class="column span-24 last">
         <h1 class="logo"><a href="/">RBleug</a></h1>
         <hr/>
         <h2 class="alt">Regilero's blog; Mostly tech things about web stuff.</h2>
       </div>
       
       <div id="menu" class="column span-24 last">
         <ul class="topNav">
            <li><a href="/" class="topNavAct" ><i class="icon-home"></i>Tech notes</a></li>
            <li><a href="/archive/"   ><i class="icon-th"></i>Archives</a></li>
            <li><a href="/contact/"  ><i class="icon-phone"></i>Contact</a></li>
            <li><a href="/feed.xml"><i class="icon-rss"></i>RSS Feed</a></li>
         </ul>
         <div class="clear"></div>
       </div>
       
       <div id="content" class="">
           <div id="left-content" class="column span-15 prepend-1">
             
            <article>
        <header>
            <h2>6 nice things not know enough about PostgreSQL
            <span><i class="icon-clock"></i><time datetime="2008-10-30">Oct 30, 2008</time></span><br/>
            <span class="category"><i class="icon-list"></i> <a href="/English/">English</a> and <a href="/PostgreSQL/">PostgreSQL</a></span>
            </h2>
        </header>

        <div class="entry">
          <img class="right" src="/theme/img/pic/redflower2.png" width="260" alt="Let's explore FillFactor, Returning inserts, TOAST, table inheritance, table partitionning and Notify/listen features." title="Let's explore FillFactor, Returning inserts, TOAST, table inheritance, table partitionning and Notify/listen features." />
          <p>With the new PostgreSQL server versions in place (8.2 and 8.3) and in a more general way with the 8.x series
some nice fonctionnalities have benn added.</p>

<p>Let's have a short look at som interesting ones:<br/>
<code>FILLFACTOR=50</code>, Id on <code>INSERT</code>, <code>TOAST</code> fields, <code>TABLE INHERITANCE</code>, <code>TABLE PARTITIONNING</code>, <code>NOTIFY</code> and <code>LISTEN</code>.</p>

<h3>WITH FILLFACTOR=50 in CREATE TABLE instructions (since 8.2):</h3>

<p>FILLFACTOR is 100% by default and is a good default setting for tables
where the basic usage is <code>INSERT</code>s (and select).<br/>
But when you know that you'll make a lot of <code>UPDATE</code>s on your rows you should decrease this factor.</p>

<p>This way <strong>some space on the table will be reserved near your inserted rows</strong>.
This space will then be used as a work zone when you'll make an <code>UPDATE</code> on the row.<br/>
And the magic effect is that this work zone won't be at the end of the table but near your row,
in the same page in memory.</p>

<p>see <a href="http://www.postgresql.org/docs/8.3/interactive/sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS">postgreSQL documentation page</a> for details.</p>

<h3>2) RETURNING on INSERT INTO to get your INSERTED Id (since 8.2):</h3>

<p>The classical way to get your <strong>'last insert Id'</strong> in PostgreSQl as always been using <code>currval(SEQUENCE)</code></p>

<p>This is right and secure as <code>PRIMARY KEYS</code> are usually defined as <code>SEQUENCE</code>s with <code>DEFAULT nextval(SEQUENCE)</code>.<br/>
And <code>currvall</code> renders the last value set by <code>nextval</code> in the current session (others concurrent sessions cannot interfere with it).</p>

<p>But that's not something easy to understand for newbies and very bad examples with <code>max(id)</code> can always be found googling around.</p>

<p>Now you can add a <strong>RETURNING MyId</strong> code on your <code>INSERT</code> query and the result of your insert won't be the row <code>OID</code> anymore
but your <code>Id</code> (or anything else if you want).</p>

<p>Consult <a href="http://www.postgresql.org/docs/8.3/interactive/sql-insert.html">postgreSQL documentation page</a> for details.</p>

<h3>3) TOAST FIELDS:</h3>

<p><code>TOAST</code> means <strong>'The Oversized-Attribute Storage Technique'.</strong></p>

<p>You can set up to <strong>1Gb</strong> in <strong>one field</strong> of your <strong>row</strong>.<br/>
This column won't be saved in the same physical file as the others. Another file will be created to store
such big fields.</p>

<p><a href="http://www.postgresql.org/docs/8.3/interactive/storage-toast.html">PostgreSQL documentation page</a> is still the best reference.</p>

<p>If you wonder about the size of your tables and the physical files on your filesystem you should not.
Your tables are always split in files of <strong>2Gb</strong>. And Toast values are stored on their own files.</p>

<h3>4) TABLE INHERITANCE:</h3>

<p>You can define a <strong>table B as child of table A</strong>.</p>

<p>Request on table <code>A</code> will then render rows from <code>A</code> and <code>B</code> tables.<br/>
With <code>ONLY</code> keyword you can limit requests on <code>A</code> with <code>A</code> rows.<br/>
<code>A</code> could have several tables (B, C, D, etc). Indexes are done tables by table, and are by this way shorter.</p>

<p>This is quite powerfull but you'll have some problems with <strong>contraints</strong>. <code>UNIQUE</code> constraints for example
are done for each table. You cannot ensure <code>A+B+C+D</code> rows will not share the same value for this <strong>'UNIQUE'</strong> constraint.</p>

<p>Setting Referential integrity from one of this table to a <code>Z</code> table is easy (but should be done for each table).<br/>
But setting the reverse relation from <code>Z</code> to <code>A+B+C+D</code> isn't possible.</p>

<p>You should really look <a href="http://www.postgresql.org/docs/8.3/interactive/ddl-inherit.html">postgreSQL documentation page</a>, as always.</p>

<h3>5) TABLE PARTITIONNING:</h3>

<p>One of the most powerfull thing you can do with <code>INHERITANCE</code> is table <code>PARTITIONNING</code>.</p>

<p>Using <code>TABLESPACE</code>s you can define several different physical storage locations for your databases.</p>

<p><code>TABLESPACES</code> can easily be used for a database, a table, or even for an index (or the WAL sync log).<br/>
This is fine. You can use several storage devices with different characteristics, each one fitting
your differents needs (capacity, speed, sync/async, etc).<br/>
But this combined with <code>INHERITANCE</code> becomes even more powerfull:<br/>
Define table <code>A</code> as an empty table.<br/>
Define table <code>B</code> and <code>C</code> as child tables of <code>A</code>, and use different tablespaces for <code>B</code> and <code>C</code>.<br/>
You then have a <strong>virtual A table</strong> with his content spread on diferent storage devices
(or not, you could use the TABLESPACE on the same storage but you'll lose most of the power of the 'thing').</p>

<p>Your benefits? <strong>smaller indexes</strong>, on different devices, which can run in <strong>parallel</strong>,
some problems with constraints as with previous part,
but this is not a problem for all tables, and for a huge table this <code>TABLESPACE</code> splitting could be
a cool thing to study.</p>

<p>Have a look at <a href="http://www.postgresql.org/docs/8.3/interactive/ddl-partitioning.html">postgreSQL documentation page</a>.</p>

<p>One last point, you'll have to defined how the rows are splitted with the different tables
(ranges, or domains, or anything else),
you'll maybe have to check <code>RULES</code> as well, even with simple <code>INHERITANCE</code>, because <code>INSERT</code>
for example should be done on the child table, and <code>INSERT</code> on the main <code>TABLE</code> should be redirected elsewhere.</p>

<h3>6) NOTIFY/LISTEN:</h3>

<p>PostgreSQL has a builtin fonctionnality for <strong>Observer/observable Design Pattern</strong>.</p>

<p>You can <code>NOTIFY</code> something, as an <code>SQL</code> command and at the end of your transaction
(or directly if you're not in a transaction) others SQL sessions which have registered this notification with <code>LISTEN</code>
will get your notification (<a href="http://www.postgresql.org/docs/8.1/interactive/libpq-notify.html">the doc</a>).<br/>
Usefull with server processes (while true processes), a cli process in PHP for example with builtin <a href="http://www.php.net/manual/en/function.pg-get-notify.php">pg lib</a>
but not with PDO actually.</p>

<p>Here is as well a <a href="http://jdbc.postgresql.org/documentation/83/listennotify.html">Java example</a> and examples in <a href="http://pypgsql.cvs.sourceforge.net/viewvc/pypgsql/pypgsql/examples/">python, the demo2a/b</a> files.</p>

        </div>
        <div class="tag"><i class="icon-tag"></i><a href="/tag/PostgreSQL/">PostgreSQL</a></div>
</article>

    
    
           </div>
           <div id="sideBar" class="column span-8 last">
            
            <div class="sideBarListBox">
              <h3>Related posts</h3>
              <ul>
                
                   <li><a href="/PostgreSQL/Francais/2010/10/14/requetes_recursives_avec_postgresql_8_4/">Requêtes récursives avec PostgreSQL 8.4 (WITH RECURSIVE)</a></li>
                
              </ul>
            </div>
            
    
        <div class="sideBarListBox">
          <h3>Latest posts</h3>
          <ul>
              
                 <li><a href="/Drupal/English/2011/10/18/drupal_mongodb_statistics_module_published/">Drupal - Mongodb statistics module published</a></li>
              
                 <li><a href="/Drupal/English/2011/10/03/separate_cache_backends_d6_and_d7/">Separate cache Backends with Drupal6 and Drupal7.</a></li>
              
                 <li><a href="/Drupal/English/2011/09/01/better_rewrite_rules_for_drupal/">Better rewriteRules for Drupal</a></li>
              
                 <li><a href="/PostgreSQL/Francais/2010/10/14/requetes_recursives_avec_postgresql_8_4/">Requêtes récursives avec PostgreSQL 8.4 (WITH RECURSIVE)</a></li>
              
                 <li><a href="/Js/English/2010/08/16/nice_webapps_and_tools_using_canvas/">Nice Webapps and tools using canvas</a></li>
              
          </ul>
        </div>
        
        <div class="sideBarMore">
          <h3>More</h3>
            <a href="http://www.flickr.com/photos/regilero/" target="_blank"><img src="/theme/img/flickr_thumb.png" width="48" height="48" alt="Flickr photos" title="Flickr photos"></a>
            <a href="https://github.com/regilero" target="_blank"><img src="/theme/img/github_thumb.png" width="48" height="48" alt="Github regilero" title="Github regilero"></a>
            <a href="https://plus.google.com/111280074129555323484?rel=author" target="_blank"><img src="/theme/img/google-plus-thumb.png" width="48" height="48" alt="G+" title="G+"></a>
            <a href="http://stackoverflow.com/users/550618/regilero" target="_blank"><img src="http://stackoverflow.com/users/flair/550618.png" width="208" height="58" alt="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers"></a>
            <a href="http://stackexchange.com/users/264377/regilero"  target="_blank"><img src="http://stackexchange.com/users/flair/264377.png?theme=clean" width="208" height="58" alt="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" /></a>
            <p>Follow me also on <a rel="me" href="http://makina-corpus.org/blogs/regilero">makina-corpus.org</a>.</p>
        </div>
        
        <div class="sideBarListBox">
          <h3>Tags</h3>
          <a style='font-size: 70%' href='/tag/Bug/'>Bug</a>
<a style='font-size: 70%' href='/tag/HTML5/'>HTML5</a>
<a style='font-size: 170%' href='/tag/HTTP/'>HTTP</a>
<a style='font-size: 70%' href='/tag/Ajax/'>Ajax</a>
<a style='font-size: 70%' href='/tag/js/'>js</a>
<a style='font-size: 113%' href='/tag/PHP/'>PHP</a>
<a style='font-size: 138%' href='/tag/Drupal/'>Drupal</a>
<a style='font-size: 70%' href='/tag/Dojo/'>Dojo</a>
<a style='font-size: 113%' href='/tag/Web/'>Web</a>
<a style='font-size: 70%' href='/tag/Monitoring/'>Monitoring</a>
<a style='font-size: 70%' href='/tag/Security/'>Security</a>
<a style='font-size: 70%' href='/tag/Mongodb/'>Mongodb</a>
<a style='font-size: 170%' href='/tag/Performance/'>Performance</a>
<a style='font-size: 70%' href='/tag/Statistics/'>Statistics</a>
<a style='font-size: 156%' href='/tag/Apache/'>Apache</a>
<a style='font-size: 113%' href='/tag/PostgreSQL/'>PostgreSQL</a>
<a style='font-size: 70%' href='/tag/Linux/'>Linux</a>
<a style='font-size: 138%' href='/tag/Proxy/'>Proxy</a>
<a style='font-size: 113%' href='/tag/RewriteMap/'>RewriteMap</a>
<a style='font-size: 70%' href='/tag/Cache/'>Cache</a>
<a style='font-size: 113%' href='/tag/Plone/'>Plone</a>
<a style='font-size: 70%' href='/tag/Js/'>Js</a>
<a style='font-size: 70%' href='/tag/ZendFramework/'>ZendFramework</a>
<a style='font-size: 70%' href='/tag/Nginx/'>Nginx</a>
<a style='font-size: 70%' href='/tag/Bash/'>Bash</a>
<a style='font-size: 138%' href='/tag/mod_rewrite/'>mod_rewrite</a>

        </div>
        
        <div class="sideBarItem">
          <h3>Friends</h3>
            <ul>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.org">Blogs Makina Corpus<div class="cover-right"><img src="/theme/img/makinaorg.png" height="30" width="30"><img src="/theme/img/makinaorg_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.com">Makina Corpus<div class="cover-right"><img src="/theme/img/makinacom.png" height="30" width="30"><img src="/theme/img/makinacom_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.processus.org/">Pounard, processus.org<div class="cover-right"><img src="/theme/img/pounard.png" height="30" width="30"><img src="/theme/img/pounard_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://toutpt.makina-corpus.org/" >Toupt<div class="cover-right"><img src="/theme/img/toupt.png" height="30" width="30"><img src="/theme/img/toupt_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://francoisgaudin.com/">François Gaudin<div class="cover-right"><img src="/theme/img/gaudin.png" height="30" width="30"><img src="/theme/img/gaudin_banner.png" height="30" width="117"></div></a></li>
            </ul>
            <div class="clear"></div>
        </div>
        
      </div> <!-- end sidebar -->
        
         </div><!-- end content -->
         
         <div id="footer" class="column span-24 last">
            <hr />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">regilero's blog</span> est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/">licence Creative Commons Attribution -  Partage dans les Mêmes Conditions 3.0 France</a>.<br />Fondé(e) sur une œuvre à <a xmlns:dct="http://purl.org/dc/terms/" href="http://regilero.github.io" rel="dct:source">http://regilero.github.io</a>.
         </div>

      </div><!-- end container -->
    </body>
</html>
