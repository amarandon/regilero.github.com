<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title> Relative/Absolute URL and Proxies |  RBleug</title>
    <meta name="description" content="Regilero's blog; Mostly tech things about web stuff."/>
    <meta name="author" content="regilero"/>
    <link rel="icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="/theme/img/regilero.ico" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script src="/theme/js/effects.js" ></script>
    <!-- <script src="/theme/js/jquery.jparallax.js"></script> -->
    <link rel="stylesheet" href="/theme/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/blueprint/print.css" type="text/css" media="print">
    <link rel="stylesheet" href="/theme/syntax.css" type="text/css" />
    <!--[if lt IE 8]>
      <link rel="stylesheet" href="/theme/blueprint/ie.css" type="text/css" media="screen, projection">
    <![endif]-->
    <link rel="stylesheet" href="/theme/blueprint/plugins/link-icons/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="/theme/fontello/css/fontello.css">
    <!--[if IE 7]><link rel="stylesheet" href="/theme/fontello/css/fontello-ie7.css"><![endif]-->
    <link href="/theme/style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="container">
       <div id="branding" class="column span-24 last">
         <h1 class="logo"><a href="/">RBleug</a></h1>
         <hr/>
         <h2 class="alt">Regilero's blog; Mostly tech things about web stuff.</h2>
       </div>
       
       <div id="menu" class="column span-24 last">
         <ul class="topNav">
            <li><a href="/" class="topNavAct" ><i class="icon-home"></i>Tech notes</a></li>
            <li><a href="/archive/"   ><i class="icon-th"></i>Archives</a></li>
            <li><a href="/contact/"  ><i class="icon-phone"></i>Contact</a></li>
            <li><a href="/feed.xml"><i class="icon-rss"></i>RSS Feed</a></li>
         </ul>
         <div class="clear"></div>
       </div>
       
       <div id="content" class="">
           <div id="left-content" class="column span-15 prepend-1">
             
            <article>
        <header>
            <h2>Relative/Absolute URL and Proxies
            <span><i class="icon-clock"></i><time datetime="2009-06-03">Jun 03, 2009</time></span><br/>
            <span class="category"><i class="icon-list"></i> <a href="/Apache/">Apache</a> and <a href="/English/">English</a></span>
            </h2>
        </header>

        <div class="entry">
          <img class="left" src="/theme/img/pic/flower3.png" width="260" alt="Let's explore FillFactor, Returning inserts, TOAST, table inheritance, table partitionning and Notify/listen features." title="Let's explore FillFactor, Returning inserts, TOAST, table inheritance, table partitionning and Notify/listen features." />
          <p>If you develop a web application you'll come soon at the moment of building your URLs.<br/>
The best thing to do, either, is handling relative URL.</p>

<p>If your app can behave with <strong>relative URL</strong> and handle a <strong>base_url</strong> prefix for sites installed in sub-directories
(like <code>'/myapp/is/here/'</code>) you'll be friend with sysadmins. -- if you use Zend Framework have a look at the <code>setBaseUrl()</code> router function--<br/>
But most app do not handle <code>URL</code>s this way, and <strong>absolute urls</strong> are used, sad world.<br/>
Then you'll find theses <code>URL</code> in HTML content, in css, in javascript, and every object generated by your web application.<br/>
 That's hell for admins. So lets look deeper.</p>

<ul>
<li>First <strong>moving</strong> your app on a <strong>different domain</strong> will maybe be harder
(especially if you're a bad coder and this absolute URL is not written once in a <strong>config file</strong>).</li>
<li>Then <strong>serving</strong> your app with <strong>different domains</strong> in the <strong>same time</strong> won't be possible.</li>
<li>And harder, you'll <strong>break proxy rewriting</strong>.</li>
</ul>


<h3>Exemple and workarounds</h3>

<p>The job of the proxy is to serve your web application on a different namespace.
Maybe you have a <strong>myapp.localnetwork.net</strong> application, that every people in <strong>localnetwork.net</strong> will see.<br/>
The proxy will server <strong>myapp.publicdomain.com</strong> or even <strong>publicdomain.com/myapp/is/here</strong>.<br/>
And the <strong>job of the proxy is only handling HTTP headers</strong>. <br/>
That means it will only rewrite things like <strong>redirections</strong> (which is a code and url in headers of the response, not in the HTTP content).</p>

<pre>
browser
\->myapp.publicdomain.com (proxy)
\->myapp.anotherproxy.domain.com (proxy)
\->myapp.localnetwork.net
</pre>


<p>So you'll maybe ask the proxy maintainer to rewrite things on the <strong>content</strong> as well.<br/>
OK, this can be done with <strong>mod_proxy_html</strong> for example in Apache.
But this as 2 drawbacks:
 * this module is parsing every content and rewriting it, that's really slower.
 * And this module cannot handle all content, it will maybe forget one of your unknow <code>localnetwork.net</code> url in a javascript file... big bugs.</p>

<h3>Real app Solutions</h3>

<p>So... if you either use <strong>absolute_url</strong>, then you should test if any proxy is between you
and the guy requesting the page.<br/>
This is given by Apache to PHP in the <strong>HTTP_X_FORWARDED_HOST</strong> parameter (or something similar
if you're not in PHP, that means it's something your webserver knows by HTTP headers of the request).<br/>
There you'll find a list of proxy used (if any) between you and the browser. <strong>Be careful</strong>, it's a <strong>coma separated list</strong>, with <strong>spaces</strong>.<br/>
The name you should use as the base name of your site is the <strong>first name of this list</strong>.</p>

<p>In our example we'll have: <code>"myapp.publicdomain.com, myapp.anotherproxy.domain.com"</code> and your absolute url to use is <code>http://myapp.publicdomain.com</code></p>

<p>With that name overriding your default base name you'll have a better app.
But the problem is not really completly fixed in fact. What you have is the <strong>host name</strong>,
but you do not have any information about the <strong>protocol</strong>.<br/>
Maybe you'll prefix the name with <strong>'http://'</strong> and it will be ok,
but maybe the proxy is using <strong>ssl</strong>
(because using ssl for a public filtering proxy before intranet
application is something used a lot). And the protocol should be <strong>'https://'</strong>.</p>

<p>If you decide to handle this in a config file of your application you'll obtain <strong>'https://'</strong> even in your local network,
where you should'nt. <br/>
Your only solution will be to tell your app which protocol to use for which name. Quite dirty.<br/>
Well, in fact there's a solution, the proxy can set:</p>

<div class="highlight"><pre><code class="apache"><span class="nb">RequestHeader</span> set X-Forwarded-Proto <span class="s2">&quot;https&quot;</span>
</code></pre></div>


<p>On his SSL configuration and you'll have <strong>HTTP_X_FORWARDED_PROTO</strong> available on your code.</p>

<p>All theses things works because of 'de facto' http headers added by mod_proxy on Apache.
You'll maybe wont have them, and your application will rely on proxy configuration. Remember <strong>relative URL</strong> is still the best solution.</p>

        </div>
        <div class="tag"><i class="icon-tag"></i><a href="/tag/Apache/">Apache</a>, <i class="icon-tag"></i><a href="/tag/HTTP/">HTTP</a>, <i class="icon-tag"></i><a href="/tag/PHP/">PHP</a>, <i class="icon-tag"></i><a href="/tag/Proxy/">Proxy</a>, <i class="icon-tag"></i><a href="/tag/Web/">Web</a></div>
</article>

    
    
           </div>
           <div id="sideBar" class="column span-8 last">
            
            <div class="sideBarListBox">
              <h3>Related posts</h3>
              <ul>
                
                   <li><a href="/Apache/English/2008/08/29/force_http_1.0_response_when_php_is_there/">Force HTTP/1.0 Apache response when PHP is there...</a></li>
                
                   <li><a href="/Js/English/2010/08/16/nice_webapps_and_tools_using_canvas/">Nice Webapps and tools using canvas</a></li>
                
                   <li><a href="/Apache/English/2009/11/06/more_on_static_file_redirector/">More on Static file redirector</a></li>
                
                   <li><a href="/Apache/English/2009/11/05/use_rewrite_map_to_prevent_proxying_for_some_static_contents/">Use RewriteMap to prevent proxying for some static contents</a></li>
                
                   <li><a href="/Monitoring/Francais/2008/05/25/temps_de_reponse_reel_d_une_page_web_avec_netcat/">Temps de réponse réél d'une page web avec ... netcat</a></li>
                
              </ul>
            </div>
            
    
        <div class="sideBarListBox">
          <h3>Latest posts</h3>
          <ul>
              
                 <li><a href="/Drupal/English/2011/10/18/drupal_mongodb_statistics_module_published/">Drupal - Mongodb statistics module published</a></li>
              
                 <li><a href="/Drupal/English/2011/10/03/separate_cache_backends_d6_and_d7/">Separate cache Backends with Drupal6 and Drupal7.</a></li>
              
                 <li><a href="/Js/English/2010/08/16/nice_webapps_and_tools_using_canvas/">Nice Webapps and tools using canvas</a></li>
              
                 <li><a href="/Apache/English/2009/11/06/more_on_static_file_redirector/">More on Static file redirector</a></li>
              
                 <li><a href="/Apache/English/2009/11/05/use_rewrite_map_to_prevent_proxying_for_some_static_contents/">Use RewriteMap to prevent proxying for some static contents</a></li>
              
          </ul>
        </div>
        
        <div class="sideBarMore">
          <h3>More</h3>
            <a href="http://www.flickr.com/photos/regilero/" target="_blank"><img src="/theme/img/flickr_thumb.png" width="48" height="48" alt="Flickr photos" title="Flickr photos"></a>
            <a href="https://github.com/regilero" target="_blank"><img src="/theme/img/github_thumb.png" width="48" height="48" alt="Github regilero" title="Github regilero"></a>
            <a href="https://plus.google.com/111280074129555323484/posts" target="_blank"><img src="/theme/img/google-plus-thumb.png" width="48" height="48" alt="G+" title="G+"></a>
            <a href="http://stackoverflow.com/users/550618/regilero" target="_blank"><img src="http://stackoverflow.com/users/flair/550618.png" width="208" height="58" alt="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for regilero at Stack Overflow, Q&amp;A for professional and enthusiast programmers"></a>
            <a href="http://stackexchange.com/users/264377/regilero"  target="_blank"><img src="http://stackexchange.com/users/flair/264377.png?theme=clean" width="208" height="58" alt="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for regilero on Stack Exchange, a network of free, community-driven Q&amp;A sites" /></a>
        </div>
        
        <div class="sideBarListBox">
          <h3>Tags</h3>
          <a style='font-size: 113%' href='/tag/RewriteMap/'>RewriteMap</a>
<a style='font-size: 113%' href='/tag/Drupal/'>Drupal</a>
<a style='font-size: 70%' href='/tag/PostgreSQL/'>PostgreSQL</a>
<a style='font-size: 156%' href='/tag/Performance/'>Performance</a>
<a style='font-size: 113%' href='/tag/Plone/'>Plone</a>
<a style='font-size: 70%' href='/tag/ZendFramework/'>ZendFramework</a>
<a style='font-size: 70%' href='/tag/Cache/'>Cache</a>
<a style='font-size: 70%' href='/tag/Monitoring/'>Monitoring</a>
<a style='font-size: 70%' href='/tag/Mongodb/'>Mongodb</a>
<a style='font-size: 113%' href='/tag/mod_rewrite/'>mod_rewrite</a>
<a style='font-size: 138%' href='/tag/Proxy/'>Proxy</a>
<a style='font-size: 138%' href='/tag/Apache/'>Apache</a>
<a style='font-size: 113%' href='/tag/PHP/'>PHP</a>
<a style='font-size: 70%' href='/tag/Statistics/'>Statistics</a>
<a style='font-size: 70%' href='/tag/Ajax/'>Ajax</a>
<a style='font-size: 70%' href='/tag/Js/'>Js</a>
<a style='font-size: 113%' href='/tag/Web/'>Web</a>
<a style='font-size: 70%' href='/tag/Nginx/'>Nginx</a>
<a style='font-size: 70%' href='/tag/Dojo/'>Dojo</a>
<a style='font-size: 70%' href='/tag/Linux/'>Linux</a>
<a style='font-size: 70%' href='/tag/js/'>js</a>
<a style='font-size: 70%' href='/tag/Bug/'>Bug</a>
<a style='font-size: 70%' href='/tag/HTML5/'>HTML5</a>
<a style='font-size: 170%' href='/tag/HTTP/'>HTTP</a>

        </div>
        
        <div class="sideBarItem">
          <h3>Friends</h3>
            <ul>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.org">Blogs Makina Corpus<div class="cover-right"><img src="/theme/img/makinaorg.png" height="30" width="30"><img src="/theme/img/makinaorg_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.makina-corpus.com">Makina Corpus<div class="cover-right"><img src="/theme/img/makinacom.png" height="30" width="30"><img src="/theme/img/makinacom_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://www.processus.org/">Pounard, processus.org<div class="cover-right"><img src="/theme/img/pounard.png" height="30" width="30"><img src="/theme/img/pounard_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://toutpt.makina-corpus.org/" >Toupt<div class="cover-right"><img src="/theme/img/toupt.png" height="30" width="30"><img src="/theme/img/toupt_banner.png" height="30" width="117"></div></a></li>
              <li><a class="effect" target="_blank" href="http://francoisgaudin.com/">François Gaudin<div class="cover-right"><img src="/theme/img/gaudin.png" height="30" width="30"><img src="/theme/img/gaudin_banner.png" height="30" width="117"></div></a></li>
            </ul>
            <div class="clear"></div>
        </div>
        
      </div> <!-- end sidebar -->
        
         </div><!-- end content -->
         
         <div id="footer" class="column span-24 last">
            <hr />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">regilero's blog</span> est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/fr/">licence Creative Commons Attribution -  Partage dans les Mêmes Conditions 3.0 France</a>.<br />Fondé(e) sur une œuvre à <a xmlns:dct="http://purl.org/dc/terms/" href="http://regilero.github.io" rel="dct:source">http://regilero.github.io</a>.
         </div>

      </div><!-- end container -->
    </body>
</html>
